# Documentation For Developers

* [How To Obtain The Source Code](#how-to-obtain-the-source-code)
* [Directory Structure](#directory-structure)
* [How To Test ACalendar](#how-to-test-acalendar)
* [Known Bugs List](#known-bugs-list)
* [Build Automation with Travis CI](#build-automation-with-travis-ci)
* [Daily Automation Builds with Cron](#daily-automation-builds-with-cron)
* [Run Unit Tests](#run-unit-tests)
* [How To Run Unit Test On Server](#how-to-run-unit-test-on-server)
* [Releasing A New Version](#releasing-a-new-version)
* [How To Build ACalendar](#how-to-build-acalendar)

##How To Obtain The Source Code
To get the source code for ACalendar, visit [this link to our github page](https://cse403deatheaters.github.io/cse403-16au-ACal/productSite.html). For direct access to our repository, visit [this link](https://github.com/CSE403DEATHEATERS/cse403-16au-ACal.git). 

For more information on how to use Github, visit [this link](https://help.github.com/).

##Directory Structure

All client side java source code and resource files: `\cse403-16au-ACal\app\src`

1. instrumentation tests that run on an Android device:
`\cse403-16au-ACal\app\src\androidTest`
2. all main sourceset files:
`\cse403-16au-ACal\app\src\main`

    *  all client side modules. Each module will contain its own model, controller(Activity in android), and services
`\cse403-16au-ACal\app\src\main\java`

        i. Event module
`\cse403-16au-ACal\app\src\main\java\Events`

        ii. Message module
`\cse403-16au-ACal\app\src\main\java\Messages`

        iii. Login module
`\cse403-16au-ACal\app\src\main\java\Login`

        iv. Email module
`\cse403-16au-ACal\app\src\main\java\Email`

    * all client side non-code resource
`\cse403-16au-ACal\app\src\main\res`

        i. definition of the entire user interface
`\cse403-16au-ACal\app\src\main\res\layout`

        ii.other resources, such as strings and color definitions
`\cse403-16au-ACal\app\src\main\res\values`

    * manifest
`\cse403-16au-ACal\app\src\main\AndroidManifest.xml`

3.   local tests that run on your host JVM
`\cse403-16au-ACal\app\src\test`
 

All server side source code including data models and functionality to be provided to AWS lambda: \cse403-16au-ACal\server

##How To Test ACalendar
Since ACalendar database are stored in Amazon Web Services (AWS), developers need to use AWS Lambda functions in Eclipse by using the AWS Toolkit for Eclipse. The AWS Toolkit for Eclipse Lambda Plugin provides a feature in which a JUnit test class is created automatically upon creation of a new AWS Lambda Java project. Lambda is a fully managed compute service that runs developers code in response to events generated by custom code. Developers need to create a Lambda handler class by the following step in Eclipse toolbar:

1. On the Eclipse toolbar, open the drop-down Amazon Web Services menu (identified by the AWS icon) and select New AWS Lambda Java project...
2. Add your Java project name, package name, and class name in the associated input boxes. You can choose any valid names that you want. While you type, the code in the Source preview will change to reflect the changes you make in the dialog.
3. For Input Type, choose Custom.
4. The second Input Type field is name of the actual Java type that will be returned, which must be a Java class (not a primitive type such as `float`, `int` or `boolean`). It defaults to `Object`. Change this value to `String`.
5. Change the value of Output Type to `String`, as well.
6. Verify that your entries look like the following screenshot (modify them if they are not), and then click Finish.

Finally, you can implement you handler function and start testing you program.


##Known Bugs List
Developers need to post discover bugs that they have been found on GitHub. They can create an issue by:

1. Open GitHub on webpage, then click on “create issue”
2. Give a title about the issue and provide little more description of the issue on the comment block.  (Note: by adding @username on the comment block, a message would send to the user)
3. Choose labels on the right of the comment block and click finish.

Then you chick the issues on bar the right-hand side of the webpage, you can see all the issues that have been post.

##Build Automation with Travis CI
Add `.travis.yml` file to root directory of the repository. Travis CI will build the project at every push and pull request. If build fails, the develop team will be notified by email.

##Daily Automation Builds with Cron

1. Configure email sending on mac: follow [this guide](http://www.developerfiles.com/how-to-send-emails-from-localhost-mac-os-x-el-capitan/)
2. Add a cronjob though the terminal:

	```
	crontab -e
    ```
    
3. This should open the editor, so add:

	```
	MAILTO=”your_email”
	*/10 23 * * * <path to ci.sh> <base_directory> <name_of_tmp_directory> <path_to_android_sdk>
    ```
with one empty line at the end of the file.

4. Format of cronjob configuration file follow [this guide](http://www.nncron.ru/help/EN/working/cron-format.htm)

##Run Unit Tests
Unit tests can be found under `.../cse403-16au-ACal/app/src/test/java/com/acalendar/acal/`. You should be able to run it directly from Android Studio: 

The Android Plugin for Gradle compiles the local unit test code located in the default directory (src/test/java), builds a test app, and executes it locally using the default test runner class.

To run local unit tests in your Gradle project from Android Studio:

1. In the Project window, right click on the project and synchronize your project.
2. Open the Build Variants window by clicking the left-hand tab, then change the test artifact to Unit Tests.
3. In the Project window, drill down to your unit test class or method, then right-click and run it. To run all tests in the unit test directory, select the directory then right-click and press Run tests.
4. Android Studio displays the results of the unit test execution in the Run window.

To run local unit tests in your Gradle project from the command-line, call the test task command.

`./gradlew test`

If there are failing tests, the command will display links to HTML reports (one per build variant). You can find the generated HTML test result reports in the <path_to_your_project>/app/build/reports/tests/ directory, and the corresponding XML files in the <path_to_your_project>/app/build/test-results/ directory.

For more information on creating and conducting unit tests in Android Studio, follow [this link](http://developer.android.com/training/testing/start/index.html#run-local-tests).

##How To Run Unit Test On Server

right click build.xml and choose run as "Ant Build"

before you do this, make sure the followings is correct in you build.xml

1. The `test name="tn"`, "tn" is the testing class you want to run
2. "pathelement location=" and "classpath= " point to the location on you local computer which contain a file called junit3.8.2.jar

##Releasing A New Version

* ###Client Side
After an updated version of the client is built and tested, it is recommended to use Gradle to generate the compiled APK file. Then the project should be pushed from local repository to the `master` branch on our repository([https://github.com/CSE403DEATHEATERS/cse403-16au-ACal](https://github.com/CSE403DEATHEATERS/cse403-16au-ACal)).

* ###Server Side
After server side codes are updated and tested, you should push it to our repository and contact us through `Acal_techteam@u.washington.edu`, and we will deploy the updated version for you.

###Download links for .apk, .tar.gz, .zip files:

* _.apk file:_ [https://github.com/CSE403DEATHEATERS/cse403-16au-ACal/tree/master/app/build/outputs/apk/app-release-unsigned.apk?raw=true](https://github.com/CSE403DEATHEATERS/cse403-16au-ACal/tree/master/app/build/outputs/apk/app-release-unsigned.apk?raw=true)
* _.zip file:_ [https://github.com/CSE403DEATHEATERS/cse403-16au-ACal/zipball/master](https://github.com/CSE403DEATHEATERS/cse403-16au-ACal/zipball/master)
* _.tar.gz file:_ [https://github.com/CSE403DEATHEATERS/cse403-16au-ACal/tarball/master](https://github.com/CSE403DEATHEATERS/cse403-16au-ACal/tarball/master)

###Update Product Website

The [Product Website](https://cse403deatheaters.github.io/cse403-16au-ACal/productSite.html) is store under the `gh-pages` branch of the project repository. To add the download links to the website, open productSite.html and modify the href attribute of the corresponding download links.

##How To Build ACalendar
The application is built using the integrated build system [Gradle](http://developer.android.com/sdk/installing/studio-build.html) of Android Studio. 
Normally, Gradle will automatically build the project after it is opened in Android Studio. To manually do this, click on the “Build” option in the menu bar, and then choose “Rebuild project”.

Other options, such as making the project and generating the APK package, could also be accessed under this menu.

You can also use the command line. On the root of the project you can run

	./gradlew assembleDebug

Which will build the project in debug mode. You can also run

	./gradlew clean

To remove any files created from the build. 
See [this link](http://developer.android.com/tools/building/building-cmdline.html) for more information on building on the command line.
